= ec2nodefinder =

This is a fork from the Dukes of Erl's ec2nodefinder : http://dukesoferl.blogspot.com/2008/02/automatic-node-discovery.html

= License =
New BSD license (http://www.opensource.org/licenses/bsd-license.php) as the original code is.

= Building =

You need ruby 1.8.6 or 1.8.7, OTP R12B5 and rake on the building machine.

Edit lib/ec2nodefinder/src/ec2nodefinder.app.src with the appropriate parameters.

Of course you can set them later or pass them on the command line when starting the VM on your EC2 instance.

rake in the main directory will provide you with a tar.gz in the distribs/ folder

= Running on EC2 =

You need a JDK, the EC2 admin tools and, of course, OTP. For each of the nodes :

On Ubuntu : 

apt-get -y install openjdk-6-jre-headless unzip
wget http://s3.amazonaws.com/ec2-downloads/ec2-api-tools.zip
cd /usr/local/
unzip ~/ec2-api-tools.zip
ln -s ec2-api-tools-1.3-30349/ ec2-api-tools

#Upload your EC2 private key and certificate to your instance.
#Upload your release to your ec2 instance(s) (S3 is a good choice for hosting your release)
sudo erl -boot start_sasl -noshell -eval 'release_handler:unpack_release("").' -s init stop

erl -boot start_sasl -name server -kernel inet_dist_listen_min 21000 \
	inet_dist_listen_max 21005 -s inets -setcookie 'XXXXXXXXXXX' -s ec2nodefinder

After a short while (mainly due to JVM startup time) :
(server@domU-12-31-39-02-65-83.compute-1.internal)3> nodes().
['server@domU-12-31-39-02-6A-48.compute-1.internal']

Nodes are discovered !

= Why a fork =

- I want to use charpi's Rakefile. It's very good. (http://charpi.net/blog/)
- There's a bug in the 0.0.8 release, which prevented ec2nodefinder from working properly :
in ec2nodefindersrv.erl:143, there's one tl() missing. 
That caused ec2nodefinder to fetch the public DNS name instead of the private one.

= Thanks =
To charpi for the Rakefile
To the dukes of erl for the code !

